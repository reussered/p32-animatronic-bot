// TFT 2.5x1.5 Display (ILI9341 driver) - RGB565 (16-bit) pixel format
// Forward declaration to resolve circular dependency
struct TFT_2P5X1P5_Pixel;
extern TFT_2P5X1P5_Pixel TFT_2P5X1P5_InitialPixel;

struct TFT_2P5X1P5_Pixel {
    unsigned int red : 5;    // 5 bits for red
    unsigned int green : 6;  // 6 bits for green
    unsigned int blue : 5;   // 5 bits for blue
    
    // Default constructor initializes to InitialPixel
    TFT_2P5X1P5_Pixel() { *this = TFT_2P5X1P5_InitialPixel; }
    
    // Copy constructor
    TFT_2P5X1P5_Pixel(const TFT_2P5X1P5_Pixel& other) {
        red = other.red;
        green = other.green;
        blue = other.blue;
    }
    
    // Assignment operator
    TFT_2P5X1P5_Pixel& operator=(const TFT_2P5X1P5_Pixel& other) {
        red = other.red;
        green = other.green;
        blue = other.blue;
        return *this;
    }

    // Add two pixels with saturation (overflow caps at max value per channel)
    TFT_2P5X1P5_Pixel operator+(const TFT_2P5X1P5_Pixel& other) const
    {
        TFT_2P5X1P5_Pixel result;
        
        // Add red channel (5 bits, max 0x1F = 31)
        unsigned int sum_r = red + other.red;
        result.red = (sum_r > 0x1F) ? 0x1F : sum_r;
        
        // Add green channel (6 bits, max 0x3F = 63)
        unsigned int sum_g = green + other.green;
        result.green = (sum_g > 0x3F) ? 0x3F : sum_g;
        
        // Add blue channel (5 bits, max 0x1F = 31)
        unsigned int sum_b = blue + other.blue;
        result.blue = (sum_b > 0x1F) ? 0x1F : sum_b;
        
        return result;
    }

    // Add-assign operator with saturation
    TFT_2P5X1P5_Pixel& operator+=(const TFT_2P5X1P5_Pixel& other)
    {
        // Add red channel (5 bits, max 0x1F = 31)
        unsigned int sum_r = red + other.red;
        red = (sum_r > 0x1F) ? 0x1F : sum_r;
        
        // Add green channel (6 bits, max 0x3F = 63)
        unsigned int sum_g = green + other.green;
        green = (sum_g > 0x3F) ? 0x3F : sum_g;
        
        // Add blue channel (5 bits, max 0x1F = 31)
        unsigned int sum_b = blue + other.blue;
        blue = (sum_b > 0x1F) ? 0x1F : sum_b;
        
        return *this;
    }
};
